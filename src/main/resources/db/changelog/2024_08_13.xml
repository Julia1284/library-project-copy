<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.6.xsd">

    <changeSet id="create tables users, roles, users_roles" author="author name">
        <sql>
            Create table if not exists users (
            id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
            email varchar UNIQUE NOT NULL,
            login varchar UNIQUE NOT NULL,
            user_password varchar NOT NULL
            );

            Create table if not exists users_roles (
            id bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
            role_name varchar UNIQUE NOT NULL
            );

            Create table if not exists users_user_roles (
            user_id bigint,
            user_role_id bigint,
            FOREIGN KEY (user_id) REFERENCES users (id) ON UPDATE CASCADE ON DELETE CASCADE,
            FOREIGN KEY (user_role_id) REFERENCES users_roles (id) ON UPDATE CASCADE ON DELETE CASCADE,
            CONSTRAINT user_user_role_pk PRIMARY KEY (user_id, user_role_id)
            );


            Insert into users (email, login, user_password) values
            ('ivanov@email.ru', 'ivanov', 'qwerty'),
            ('petrov@gmail.ru', 'petrov', 'ytrewq'),
            ('sidorov@yandex.ru', 'sidorov', '123456');

            Insert into users_roles(role_name) values
            ('ADMIN'),
            ('USER');


            Insert into users_user_roles(user_id, user_role_id) values
            (1, 1),
            (2, 2),
            (3, 2);

        </sql>
    </changeSet>
</databaseChangeLog>